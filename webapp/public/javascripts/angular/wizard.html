<div class="row">
  <div class="col-md-12">
    <div style="padding-bottom: 50px;">
      <a ui-sref="advanced" class="btn btn-default pull-right" ng-show="isWizard" ng-click="onFormView()"><i class="fa fa-gear" style="margin-right: 3px;"></i>{{ i18n.__('Expert mode') }}</a>
      <a ui-sref="wizard" class="btn btn-default pull-right" ng-show="!isWizard" ng-click="onFormView()"><i class="fa fa-magic" style="margin-right: 3px;"></i>{{ i18n.__('Wizard mode') }}</a>
    </div>
    <!-- alert box -->
    <terrama2-alert-box2 handler="MessageBoxService.alertBox" close="MessageBoxService.reset()" extra=MessageBoxServe.alertBox.extra></terrama2-alert-box2>
  </div>

  <wizard template="/dist/templates/templates/terrama2-wizard.html">
    <wz-step wz-title="{{ i18n.__('General') }}" canexit="isFirstStepValid" wz-data="wizard.general">
      <div class="col-md-12">
        <form name="forms.generalDataForm">
          <div ng-include="'/dist/templates/generalData.html'"></div>
        </form>
      </div>

      <div class="col-md-12">
        <div class="pull-right">
          <button class="btn btn-primary" type="submit" wz-next>{{ i18n.__('Next') }}</button>

          <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save')" ng-show="!isDynamic" data-ng-click="save(false);"></button>

          <div class="btn-group pull-right" style="margin-left: 3px;" ng-show="isDynamic && storager.format">
            <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save and Run')" data-ng-click="save(true);"></button>
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="caret"></span>
              <span class="sr-only"></span>
            </button>
            <ul class="dropdown-menu terrama2-button-dropdown">
              <li><a href="javascript::void();" data-ng-click="save(false);" ng-bind="i18n.__('Save')"></a></li>
            </ul>
          </div>
          <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save')" ng-show="isDynamic && !storager.format" data-ng-click="save(false);"></button>
        </div>
      </div>
    </wz-step>

    <wz-step wz-title="{{ i18n.__('Parameters') }}" canexit="isSecondStepValid" wz-data="wizard.parameters">
      <div class="col-md-12">

        <div class="col-md-12">
          <!-- schema form -->
          <form name="forms.parametersForm" sf-schema="schema" sf-form="form" sf-model="model" sf-options="options"></form>

          <div class="col-md-2 terrama2-top-field">
            <button class="btn btn-default" ng-show="semantics === 'DCP'" ng-click="addDcp(parametersForm)">{{ i18n.__('Add') }}</button>
          </div>

          <div ng-include="'/dist/templates/dcpTable.html'"></div>
        </div>

      </div>

      <div class="col-md-12">
        <div class="pull-right">
          <button class="btn btn-primary" type="submit" wz-previous>{{ i18n.__('Previous') }}</button>
          <button class="btn btn-primary" type="submit" ng-show="isDynamic && (!wizard.store.disabled || !wizard.filter.disabled || !wizard.intersection.disabled)" ng-click="goToValidNextStep('parametersForm');" wz-next>{{ i18n.__('Next') }}</button>
          <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save')" ng-show="!isDynamic" data-ng-click="save(false);"></button>

          <div class="btn-group pull-right" style="margin-left: 3px;" ng-show="isDynamic && storager.format">
            <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save and Run')" data-ng-click="save(true);"></button>
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="caret"></span>
              <span class="sr-only"></span>
            </button>
            <ul class="dropdown-menu terrama2-button-dropdown">
              <li><a href="javascript::void();" data-ng-click="save(false);" ng-bind="i18n.__('Save')"></a></li>
            </ul>
          </div>
          <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save')" ng-show="isDynamic && !storager.format" data-ng-click="save(false);"></button>
        </div>
      </div>

    </wz-step>

    <wz-step wz-title="{{ i18n.__('Store') }}" canexit="validateSteps" wz-disabled="{{ !isDynamic }}" wz-data="wizard.store" canenter="!wizard.store.disabled">
      <div class="col-md-12">

        <div class="row" ng-controller="DataSeriesStoragerController">

          <div class="col-md-12">
            <form name="forms.storagerDataForm">

              <div class="col-md-4">
                <div class="form-group" terrama2-show-errors>
                  <label ng-bind="i18n.__('Output Format')">:</label>
                    <select id="storageFormat" 
                            class="form-control" 
                            name="format" 
                            ng-model="storager.format"
                            ng-disabled="isUpdating && hasCollector"
                            ng-change="onStoragerFormatChange()"
                            ng-options="format.name for format in storagerFormats | filter: { collector: false }" 
                            required>
                  </select>
                  <label class="help-block text-danger"
                        ng-show="forms.storagerDataForm.format.$dirty && forms.storagerDataForm.format.$error.required"
                        ng-bind="i18n.__('Output format is required')">
                  </label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group" terrama2-show-errors>
                  <label ng-bind="i18n.__('Data Store')">:</label>
                  <select class="form-control" 
                          name="storager_data_provider_id" 
                          ng-model="storager_data_provider_id"
                          ng-options="provider.id as provider.name for provider in dataProvidersStorager" 
                          required>
                    <option></option>
                  </select>

                  <label class="help-block text-danger"
                        ng-show="forms.storagerDataForm.storager_data_provider_id.$dirty && forms.storagerDataForm.storager_data_provider_id.$error.required"
                        ng-bind="i18n.__('Data Store is required')">
                  </label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-group" terrama2-show-errors>
                  <label ng-bind="i18n.__('Service')">:</label>
                  <select id="storageService" 
                          class="form-control" 
                          name="service" 
                          ng-model="storager_service"
                          required
                          ng-options="service.id as service.name for service in services">
                  </select>

                  <label class="help-block text-danger"
                        ng-show="forms.storagerDataForm.service.$dirty && forms.storagerDataForm.service.$error.required"
                        ng-bind="i18n.__('Service is required')">
                  </label>
                </div>
              </div>
            </form>
          </div>

          <div class="col-md-12">
            <!-- schema form -->
            <div class="col-md-12" ng-show="showStoragerForm">
              <form name="forms.storagerForm" sf-schema="schemaStorager" sf-form="formStorager" sf-model="modelStorager" sf-options="options"></form>
            </div>

            <div class="col-md-12">
              <!--dcp table -->
              <div class="col-md-12 terrama2-nopadding-box" ng-if="semantics === 'DCP' && storager.format && storager.format.code && isDynamic">
                <div class="col-md-12">
                  <div class="row">
                    <div class="box-body table-responsive no-padding">
                      <table class="table table-hover" >
                        <tbody style="overflow-y: auto; height: 150px;">
                        <!-- header-->
                        <tr style="height: 30px;">
                          <th ng-repeat="field in tableFieldsStorager">{{ capitalizeIt(field) }}</th>
                          <th>ID</th>
                        </tr>

                        <tr ng-repeat="dcp in dcpsStorager track by $index">
                          <td ng-repeat="field in tableFieldsStorager">
                            <!-- todo: fix it -->
                            <span ng-if="field.toLowerCase() == 'table_name'" editable-text="dcp[field]">
                              {{ dcp[field]}}
                            </span>

                            <span ng-if="field.toLowerCase() != 'table_name'">
                              <span ng-show="!isBoolean(dcp[field])" ng-bind="dcp[field]"></span>
                              <span ng-show="isBoolean(dcp[field])">
                                <input type="checkbox" ng-model="dcp[field]" ng-disabled="true">
                              </span>
                            </span>
                          </td>
                          <td> {{ $index + 1 }}</td>
                        </tr>
                        </tbody>
                      </table>
                    </div><!-- /.box-body -->
                  </div>
                </div>
              </div>
            </div>

          </div>

          <div class="col-md-12" style="margin-top: 30px;">
            <div class="col-md-12">
              <div class="box box-default box-solid">
                <div class="box-header with-border">
                  <h3 class="box-title">{{ i18n.__('Schedule') }}</h3>
                </div>

                <div style="display: block;" class="box-body">
                  <terrama2-schedule model="schedule" options="scheduleOptions"></terrama2-schedule>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="col-md-12">
        <div class="pull-right">
          <button class="btn btn-primary" type="submit" wz-previous>{{ i18n.__('Previous') }}</button>
          <button class="btn btn-primary" type="submit" ng-show="!wizard.filter.disabled || !wizard.intersection.disabled" ng-click="goToValidNextStep('storagerForm');" wz-next>{{ i18n.__('Next') }}</button>

          <div class="btn-group pull-right" style="margin-left: 3px;" ng-show="isDynamic && storager.format">
            <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save and Run')" data-ng-click="save(true);"></button>
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="caret"></span>
              <span class="sr-only"></span>
            </button>
            <ul class="dropdown-menu terrama2-button-dropdown">
              <li><a href="javascript::void();" data-ng-click="save(false);" ng-bind="i18n.__('Save')"></a></li>
            </ul>
          </div>
          <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save')" ng-show="isDynamic && !storager.format" data-ng-click="save(false);"></button>
        </div>
      </div>
    </wz-step>

    <wz-step wz-title="{{ i18n.__('Filters') }}" canexit="validateSteps" wz-disabled="{{ !isDynamic }}" wz-data="wizard.filter" canenter="!wizard.filter.disabled">
      <div class="col-md-12">
        <div ng-include="'/dist/templates/filter.html'"></div>
      </div>
      <div class="col-md-12">
        <div class="pull-right">
          <button class="btn btn-primary" type="submit" ng-click="goToValidPreviousStep('filterForm');" wz-previous>{{ i18n.__('Previous') }}</button>
          <button class="btn btn-primary" type="submit" ng-show="isDynamic && semantics !== 'GRID' && !wizard.intersection.disabled" ng-click="goToValidNextStep('filterForm');" wz-next>{{ i18n.__('Next') }}</button>
          <div class="btn-group pull-right" style="margin-left: 3px;" ng-show="isDynamic && storager.format">
            <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save and Run')" data-ng-click="save(true);"></button>
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="caret"></span>
              <span class="sr-only"></span>
            </button>
            <ul class="dropdown-menu terrama2-button-dropdown">
              <li><a href="javascript::void();" data-ng-click="save(false);" ng-bind="i18n.__('Save')"></a></li>
            </ul>
          </div>
          <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save')" ng-show="isDynamic && !storager.format" data-ng-click="save(false);"></button>
        </div>
      </div>
    </wz-step>

    <wz-step wz-title="{{ i18n.__('Intersection') }}" canexit="validateSteps" wz-disabled="{{ !isDynamic || semantics === 'GRID' }}" wz-data="wizard.intersection" canenter="!wizard.intersection.disabled">
      <div class="col-md-12">
        <div ng-include="'/dist/templates/data-series/templates/intersection.html'">
        </div>
      </div>

      <div class="col-md-12">
        <div class="pull-right">
          <button class="btn btn-primary" type="submit" ng-click="goToValidPreviousStep('intersectionForm');" wz-previous>{{ i18n.__('Previous') }}</button>

          <div class="btn-group pull-right" style="margin-left: 3px;" ng-show="isDynamic && storager.format">
            <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save and Run')" data-ng-click="save(true);"></button>
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class="caret"></span>
              <span class="sr-only"></span>
            </button>
            <ul class="dropdown-menu terrama2-button-dropdown">
              <li><a href="javascript::void();" data-ng-click="save(false);" ng-bind="i18n.__('Save')"></a></li>
            </ul>
          </div>
          <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save')" ng-show="isDynamic && !storager.format" data-ng-click="save(false);"></button>
        </div>
      </div>
    </wz-step>

  </wizard>

</div>

<!-- List with database tables -->
<datalist id='databaseTableList'>
    <option ng-repeat="table in tableList" value="{{table}}">
</datalist>