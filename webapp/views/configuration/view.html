{% extends "../base/layout.html" %}

{% set tabActive = "views" %}

{% block ngApp %} ng-app="terrama2.views.controllers.viewregisterupdate" {% endblock %}

{% block title %} TerraMA² {{ i18n.__('View Registration') }} {% endblock %}

{% block styles %}
  <!-- Bootstrap Eonasdan datatimepicker (used in TerraMA² datetimepicker wrapper) -->
  <link rel="stylesheet" href="/bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.css">

  <!-- Angular Color Picker -->
  <link rel="stylesheet" href="/bower_components/angular-color-picker/dist/angularjs-color-picker.min.css" />
  <!-- only include if you use bootstrap -->
  <link rel="stylesheet" href="/bower_components/angular-color-picker/dist/themes/angularjs-color-picker-bootstrap.min.css" />
  <!-- Angular xEditable -->
  <link href="/bower_components/angular-xeditable/dist/css/xeditable.css" rel="stylesheet">

  <style>
    .has-feedback label~.form-control-feedback {
      top: 25px !important;
      margin-right: 20px !important;
    }
  </style>
{% endblock %}

{% block javascripts %}

<script>
  var configuration = {
    view: {[ view|json|safe ]}
  };
</script>

<!-- Moment Datetime JS -->
<script type="text/javascript" src="/bower_components/moment/moment.js"></script>
<!-- Ace editor -->
<script type="text/javascript" src="/bower_components/ace-builds/src/ace.js"></script>
<script type="text/javascript" src="/bower_components/ace-builds/src/ext-language_tools.js"></script>

<!-- Angular Schema Form dependencies -->
<script type="text/javascript" src="/bower_components/angular-sanitize/angular-sanitize.js"></script>
<script type="text/javascript" src="/bower_components/tv4/tv4.js"></script>
<script type="text/javascript" src="/bower_components/objectpath/lib/ObjectPath.js"></script>
<script type="text/javascript" src="/bower_components/angular-schema-form/dist/schema-form.js"></script>
<script type="text/javascript" src="/bower_components/angular-schema-form/dist/bootstrap-decorator.min.js"></script>
<!-- Bootstrap datetimepicker -->
<script type="text/javascript" src="/bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>

<script type="text/javascript" src="/bower_components/moment/locale/pt-br.js"></script>
<script type="text/javascript" src="/bower_components/moment/locale/es.js"></script>
<script type="text/javascript" src="/bower_components/moment/locale/fr.js"></script>
<script type="text/javascript" src="/bower_components/angular-eonasdan-datetimepicker/dist/angular-eonasdan-datetimepicker.min.js"></script>

<!-- Angular Color Picker -->
<script src="/bower_components/tinycolor/dist/tinycolor-min.js"></script>
<script src="/bower_components/angular-color-picker/dist/angularjs-color-picker.min.js"></script>

<!-- XEditable  -->
<script src="/bower_components/angular-xeditable/dist/js/xeditable.js"></script>

{% endblock %}

{% block content %}

<div ng-controller="ViewRegisterUpdateController as ctrl">
  <terrama2-box title="i18n.__(ctrl.isUpdating ? 'View Update' : 'View Registration')">
    <div class="col-md-12">
      <terrama2-alert-box2 handler="ctrl.MessageBoxService.alertBox" close="ctrl.close()"></terrama2-alert-box2>
    </div>
    <terrama2-box title="i18n.__('General Data')" css="ctrl.css">
      <form name="forms.viewForm">
        <div class="row">
          <div class="col-md-12">
            <div class="col-md-6">
              <div class="form-group" terrama2-show-errors>
                <label><span ng-bind="i18n.__('Name')">:</span></label>
                <input class="form-control" 
                       name="name" 
                       ng-model="ctrl.view.name" 
                       placeholder="{{ i18n.__('View Name') }}" type="text" required>

                <span class="help-block" 
                      ng-show="forms.viewForm.name.$dirty && forms.viewForm.name.$invalid" 
                      ng-class="{'has-error': viewForm.name.$invalid}"
                      ng-bind="i18n.__('View name is required')">
                </span>
              </div>
            </div> <!-- ./col-md-5 -->
            <div class="col-md-4">
              <div class="form-group" terrama2-show-errors>
                <label><span ng-bind="i18n.__('Service')">:</span></label>
                <select class="form-control" 
                        name="service" 
                        ng-model="ctrl.view.service_instance_id"
                        ng-options="instance.id as instance.name for instance in ctrl.filteredServices" 
                        required>
                  <option ng-if="ctrl.filteredServices.length == 0" 
                          value="" 
                          ng-bind="i18n.__('No view service found')">
                  </option>
                </select>

                <span class="help-block" 
                      ng-show="forms.viewForm.service.$dirty && forms.viewForm.service.$error.required"
                      ng-bind="i18n.__('Service is required')">
                </span>
              </div>
            </div> <!-- ./col-md-5 -->
            <div class="col-md-2">
              <div class="form-group">
                <div class="checkbox">
                  <label style="font-weight: 700; margin-top:19px;">
                    <input type="checkbox" 
                           name="active" 
                           ng-model="ctrl.view.active"
                           ng-init="ctrl.initActive()"> <span ng-bind="i18n.__('Active')"></span>
                  </label>
                </div>
              </div>
            </div> <!-- ./col-md-2 -->
          </div><!-- ./col-md-12 -->
          <div class="col-md-12">
            <div class="col-md-12">
              <div class="form-group">
                <label><span ng-bind="i18n.__('Description')"></span>:</label>
                <textarea class="form-control" 
                          ng-model="ctrl.view.description" 
                          rows="3" 
                          placeholder="{{ i18n.__('View Description') }}"></textarea>
              </div>
              <!-- /.form-group -->
            </div>
          </div>
        </div>
      </form>
    </terrama2-box>

    <terrama2-box title="i18n.__('Data Series')" css="ctrl.css">
      <form name="forms.dataSeriesForm">
        <div class="col-md-6">
          <div class="form-group" terrama2-show-errors>
            <label><span ng-bind="i18n.__('View Data Series')"></span>:</label>
            <select class="form-control" 
                    name="dataSeries" 
                    ng-model="ctrl.view.data_series_id"
                    ng-options="dSeries.id as dSeries.name for dSeries in ctrl.dataSeries | orderBy: 'name'"
                    ng-change="ctrl.onDataSeriesChanged(ctrl.view.data_series_id, dSeries)"
                    required>
            </select>

            <span class="help-block" 
              ng-show="forms.dataSeriesForm.dataSeries.$dirty && forms.dataSeriesForm.dataSeries.$error.required"
              ng-bind="i18n.__('Data Series is required')">
            </span>
          </div>
        </div>
      </form>
    </terrama2-box>

    <terrama2-box title="i18n.__('Schedule')" css="ctrl.css" ng-show="ctrl.isDynamic">
      <div class="col-md-12">
        <terrama2-schedule model="ctrl.view.schedule" options="ctrl.scheduleOptions"></terrama2-schedule>
      </div>
    </terrama2-box>

    <terrama2-box title="i18n.__('Style')" css="ctrl.css"
                  ng-show="ctrl.viewDataSeries.data_series_semantics.data_series_type_name && ctrl.viewDataSeries.data_series_semantics.data_series_type_name !== ctrl.DataSeriesType.DCP">
      <form name="forms.styleForm" editable-form>      
        <!-- Vectorial -->
        <div class="col-md-12 terrama2-nopadding-box"
             ng-show="ctrl.viewDataSeries.data_series_semantics.data_series_type_name === ctrl.DataSeriesType.GEOMETRIC_OBJECT">
          <div class="col-md-12 terrama2-nopadding-box">
            <div class="col-md-6">
              <div class="form-group" terrama2-show-errors>
                <label><span ng-bind="i18n.__('Column')"></span>:</label>
                <input class="form-control" 
                      name="column" 
                      ng-model="ctrl.view.column" 
                      type="text"
                      ng-required="ctrl.viewDataSeries.data_series_semantics.data_series_type_name === ctrl.DataSeriesType.GEOMETRIC_OBJECT">

                <span class="help-block" 
                  ng-show="forms.styleForm.column.$dirty && forms.styleForm.column.$error.required"
                  ng-bind="i18n.__('Column is required')">
                </span>
              </div>
            </div>
          </div>
          <!-- ./col-md-6 Type -->
          <div class="col-md-6">
            <div class="form-group" terrama2-show-errors>
              <label><span ng-bind="i18n.__('Type')"></span>:</label>
              <select class="form-control" 
                      name="styleType" 
                      ng-model="ctrl.view.typeId"
                      ng-required="ctrl.viewDataSeries.data_series_semantics.data_series_type_name === ctrl.DataSeriesType.GEOMETRIC_OBJECT"
                      ng-options="value as key for (key, value) in ctrl.StyleType">
              </select>

              <span class="help-block" 
                ng-show="forms.styleForm.styleType.$dirty && forms.styleForm.styleType.$error.required"
                ng-bind="i18n.__('Type is required')">
              </span>
            </div>
          </div>
          <!-- ./col-md-6 Type -->
          <div class="col-md-6">
            <div class="form-group" terrama2-show-errors>
                <label><span ng-bind="i18n.__('Bands')">:</span></label>
                <input class="form-control" 
                       name="bands" 
                       ng-model="ctrl.view.bands" 
                       type="number"
                       min="0"
                       ng-required="ctrl.viewDataSeries.data_series_semantics.data_series_type_name === ctrl.DataSeriesType.GEOMETRIC_OBJECT">

                <span class="help-block" 
                      ng-show="forms.styleForm.bands.$dirty && forms.styleForm.bands.$invalid" 
                      ng-class="{'has-error': styleForm.bands.$invalid}"
                      ng-bind="i18n.__('Bands is required for color ramp generation')">
                </span>
            </div>

            <!-- List with Fields auto-complete -->
            <!--<datalist id='columnsList'>
                <option ng-repeat="band iin ctrl.columnsList" value="{{ band }}">
            </datalist>-->
          </div>

          <div class="col-md-3">
            <div class="form-group" terrama2-show-errors>
              <label ng-bind="i18n.__('Begin')"></label>
              <color-picker contenteditable="true" ng-model="ctrl.view.beginColor" options="ctrl.colorOptions"></color-picker>
            </div>
          </div>

          <div class="col-md-3">
            <div class="form-group" terrama2-show-errors>
              <label ng-bind="i18n.__('End')"></label>
              <color-picker contenteditable="true" ng-model="ctrl.view.endColor" options="ctrl.colorOptions"></color-picker>
            </div>
          </div>          

          <div class="col-md-2">
            <button type="button" 
                    class="btn btn-primary" 
                    style="margin-top: 25px;" 
                    ng-bind="i18n.__('Generate')" 
                    data-ng-click="ctrl.view.typeId && ctrl.generateColors();"></button>
          </div>
        </div>
        <div class="col-md-12" ng-show="ctrl.view.typeId && ctrl.colors.length > 0">
          <table class="table table-hover scroll">
            <thead>
              <th ng-bind="i18n.__('Color')"></th>
              <th ng-bind="i18n.__('Title')"></th>
              <th ng-bind="i18n.__('Value')"></th>
            </thead>
            <tbody>
              <tr ng-repeat="elm in ctrl.colors track by $index">
                <td>
                  <color-picker ng-model="elm.color" options="ctrl.colorOptions" event-api="ctrl.events"></color-picker>
                </td>
                <td>
                  <input type="text" class="form-control" name="field_color_{{ $index }}" ng-model="elm.title">
                </td>
                <td>
                  <input type="text" class="form-control" name="field_value_{{ $index }}" ng-model="elm.value">
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- GRID -->
        <div class="col-md-12 terrama2-nopadding-box"
             ng-show="ctrl.viewDataSeries.data_series_semantics.data_series_type_name === ctrl.DataSeriesType.GRID">
          <div class="col-md-12">
            <div class="col-md-6">
              <div class="form-group" terrama2-show-errors>
                <label ng-bind="i18n.__('Min value')"></label>
                <input class="form-control" 
                      name="minValue"
                      ng-model="ctrl.minValue" 
                      placeholder="{{ i18n.__('Min value') }}" type="number"
                      ng-required="ctrl.viewDataSeries.data_series_semantics.data_series_type_name === ctrl.DataSeriesType.GRID">

                <span class="help-block" 
                  ng-show="forms.styleForm.minValue.$dirty && forms.styleForm.minValue.$error.required"
                  ng-bind="i18n.__('Min value is required for GRID data series')">
                </span>
              </div>
            </div> <!-- ./col-md-6 -->
            <div class="col-md-6">
              <div class="form-group">
                <label ng-bind="i18n.__('Color')"></label>
                <color-picker ng-model="ctrl.minColor" options="ctrl.colorOptions"></color-picker>
              </div>
            </div><!-- ./col-md-6 -->
          </div>

          <div class="col-md-12">
            <div class="col-md-6">
              <div class="form-group" terrama2-show-errors>
                <label ng-bind="i18n.__('Max value')"></label>
                <input class="form-control" 
                      name="maxValue" 
                      ng-model="ctrl.maxValue" 
                      placeholder="{{ i18n.__('Max value') }}" type="number"
                      ng-required="ctrl.viewDataSeries.data_series_semantics.data_series_type_name === ctrl.DataSeriesType.GRID">
                <span class="help-block" 
                  ng-show="forms.styleForm.maxValue.$dirty && forms.styleForm.maxValue.$error.required"
                  ng-bind="i18n.__('Max value is required for GRID data series')">
                </span>
              </div>
            </div> <!-- ./col-md-6 -->
            <div class="col-md-6">
              <div class="form-group">
                <label ng-bind="i18n.__('Color')"></label>
                <color-picker ng-model="ctrl.maxColor" options="ctrl.colorOptions"></color-picker>
              </div>
            </div><!-- ./col-md-6 -->
          </div>
        </div>
      </form>
    </terrama2-box>

    <div class="box-footer">
      <div class="btn-group pull-right" style="margin-left: 10px;">
        <button type="button" class="btn btn-primary" ng-bind="i18n.__('Save and Run')" data-ng-click="ctrl.save(true);"></button>
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <span class="caret"></span>
          <span class="sr-only"></span>
        </button>
        <ul class="dropdown-menu terrama2-button-dropdown">
          <li><a href="javascript::void();" data-ng-click="ctrl.save(false);" ng-bind="i18n.__('Save')"></a></li>
        </ul>
      </div>
      <a href="/configuration/views/" class="btn btn-primary pull-right" style="margin-left: 10px;">
        <span ng-bind="i18n.__('Cancel')"></span>
      </a>
    </div>
  </terrama2-box>

</div> <!-- end col md 12 -->

{% endblock %}
